<!DOCTYPE HTML>
<html>

<head>
    <title>
        EDMR
    </title>
    <style>
      canvas {
        background-color: #000000;
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0px;
        left: 0px;
      }
      ul{
        list-style-type: none;
      }
      body {
        /* disable pull to refresh, and horizontal overscroll behavior
        it interfears with the swipe down to slow down functionality */
        overscroll-behavior: contain;
        /* disable text selection */
        user-select:none;
        
        color: #3c484e;
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Open Sans, Helvetica Neue, sans-serif;
        font-size: 1.5rem;
        line-height: 1.6em;
        font-weight: 400;
        font-style: normal;
        letter-spacing: 0;
        text-rendering: optimizeLegibility;
        background: #e2dbdb;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -moz-font-feature-settings: "liga" on;
      }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js" integrity="sha512-UXumZrZNiOwnTcZSHLOfcTs0aos2MzBWHXOHOuB0J/R44QB0dwY5JgfbvljXcklVf65Gc4El6RjZ+lnwd2az2g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</head>

<body>
    <center>
      <h1>EDMR</h1>
      <a onclick="javascript:mode='HORIZONTAL';" href="javascript:void(0);">Horizontal</a>
      <a onclick="javascript:mode='FIGURE8';" href="javascript:void(0);">Figure 8</a>
      <p>
      Control using your keyboard or swipe/tap
      </p>
      <p><em></em><small>Press F11 to enter FULLSCREEN mode</small></em></p>
      
      <ul>
      <li>Start/Stop - Space Bar/Tap</li>
      <li>Faster - ↑</li>
      <li>Slower - ↓ </li>
      <li>Larger - →</li>
      <li>Smaller - ←</li>
      </ul>
        <canvas>
        </canvas>
        <script>
            var canvas = document.querySelector("canvas");
            canvas.hidden = true;
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            var l = canvas.getContext('2d');
            
            // x and y are the co-ordinates of the circle
            var x = Math.floor(Math.random() * innerWidth);
            var y = Math.floor(canvas.height * 0.5)
            
            // xVelocity and yVelocity are the respective speeds
            var xVelocity = 20; //only horizontal
            var yVelocity = 0;
            
            var radius = 20;
            
            var run = false;
            
            
            //for figure 8
            var t = 0;
	          var xstart = Math.floor(innerWidth/2);
  	        var ystart = Math.floor(innerHeight/2);
    	      var xrad = xstart-20;
      	    var yrad = ystart-20;

						//var direction = 1;
            
            var mode = "HORIZONTAL";

            const moveHorizontal=function() {
                //handle bouncing
                if (radius + x > innerWidth)
                  xVelocity = 0 - xVelocity;
                
                if (x - radius < 0)
                  xVelocity = 0 - xVelocity;

                if (y + radius > innerHeight)
                  yVelocity = 0 - yVelocity;

                if (y - radius < 0)
                  yVelocity = 0 - yVelocity;

                x = x + xVelocity;
                y = y + yVelocity;
            }

            const moveFigure8=function() {
              var dt = Math.PI / (3 * 20+(20-xVelocity));
                x = xstart + xrad * Math.sin(t + Math.PI/2);
                y = ystart + yrad * Math.sin(2 * t);

                t += dt;
                if (t >= 2 * Math.PI)
                {
                  t -= 2 * Math.PI;
                }
            }
            
            const speedup = function(){
              var direction = xVelocity != 0 ? xVelocity/Math.abs(xVelocity) : 1; //either 1 or -1
              xVelocity = (Math.abs(xVelocity)+1)*direction;
            }
            const slowdown = function(){
              var direction = xVelocity != 0 ? xVelocity/Math.abs(xVelocity) : 1; //either 1 or -1
              xVelocity = (Math.abs(xVelocity)-1)*direction;
            }
            const smaller = function(){
              radius = radius-1;
              if(radius === 0) radius = 1;
            }
            const bigger = function(){
              radius++;
              if(radius > Math.floor(innerHeight/2)) radius = Math.floor(innerHeight/2);
            }
            const startstop = function(){
                run = !run;
				        canvas.hidden = !run;
                move();
            }

            //wire up Keyboard events
						onkeydown = (event) => {
              if (event.isComposing || event.keyCode === 229) return;
              //speed up
              if(event.keyCode === 38) speedup();
              //slow down
              else if(event.keyCode === 40) slowdown();
              //smaller circle
              else if(event.keyCode === 37) smaller();
              //bigger circle
              else if(event.keyCode === 39) bigger();
              //start/stop
              else if(event.keyCode === 32) startstop();
            };
            
            //wireup Touch events
            var hammertime = new Hammer(document);
            hammertime.get('swipe').set({ direction: Hammer.DIRECTION_ALL });
            //speed up
            hammertime.on('swipeup', (ev)=>speedup());
            //slow down
            hammertime.on('swipedown', (ev)=>slowdown());
            //smaller circle
            hammertime.on('swipeleft', (ev) =>smaller());
            //bigger circle
            hammertime.on('swiperight', (ev)=>bigger());
            //start/stop
            hammertime.on('tap', (ev)=>startstop());
            

            		
            // This function will do the animation
            function move() {
              if(!run) return;
              
            	requestAnimationFrame(move);
              
            
            	// It clears the specified pixels within
            	// the given rectangle
            	l.clearRect(0, 0, innerWidth, innerHeight);
            
            	// Creating a circle
            	l.beginPath();
            	l.strokeStyle = "white";
            	l.arc(x, y, radius, 0, Math.PI * 2, false);
            	l.fillStyle="white";
            	l.fill();
            	l.stroke();
              
              l.fillStyle="#A9A9A9"
              l.font = "10px Arial";
              l.fillText(`R:${radius}/V:${Math.abs(xVelocity)}`, 0, innerHeight-10);
              
              //bounce left and right
            	// Conditions sso that the ball bounces from the edges
              if(mode=="HORIZONTAL") moveHorizontal();
              //lets do a figure 8
              //use xVelocity for speed
              else if(mode=="FIGURE8") moveFigure8();
              //unknown
              else{
              	console.log(`Unknown mode:${mode}`);
              }
            }

            function openFullscreen() {
              if (elem.requestFullscreen) {
                elem.requestFullscreen();
              } else if (elem.webkitRequestFullscreen) { /* Safari */
                elem.webkitRequestFullscreen();
              } else if (elem.msRequestFullscreen) { /* IE11 */
                elem.msRequestFullscreen();
              }
            }
        </script>
    </center>
</body>

</html>